<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch Check-in - Qu·∫£n l√Ω Kh√°ch s·∫°n</title>
    <style>
        :root {
            --primary-color: #20b2aa;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ecf0f1;
            --sidebar-hover-bg: #34495e;
            --sidebar-active-bg: var(--primary-color);
            --header-height: 60px;
            --sidebar-width: 260px;
            --sidebar-collapsed-width: 0px;
            --transition-speed: 0.3s;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; }
        .dashboard-container { display: grid; grid-template-columns: var(--sidebar-width) 1fr; grid-template-rows: var(--header-height) 1fr auto; grid-template-areas: "header header" "sidebar content" "sidebar footer"; height: 100vh; transition: grid-template-columns var(--transition-speed) ease; }
        .dashboard-container.sidebar-collapsed { grid-template-columns: var(--sidebar-collapsed-width) 1fr; }
        .header { grid-area: header; background-color: #ffffff; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); display: flex; align-items: center; padding: 0 20px; z-index: 10; }
        .menu-icon { cursor: pointer; font-size: 24px; color: #333; margin-right: 20px; }
        .header-title { font-size: 1.5rem; color: var(--primary-color); font-weight: 600; margin-right: auto; }
        .user-profile { display: flex; align-items: center; gap: 10px; }
        .user-profile img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .sidebar { grid-area: sidebar; background-color: var(--sidebar-bg); color: var(--sidebar-text); padding-top: 10px; overflow: hidden; white-space: nowrap; transition: width var(--transition-speed) ease; }
        .sidebar-header { display: flex; align-items: center; gap: 15px; padding: 10px 20px 20px 20px; }
        .sidebar-header .menu-icon { color: var(--sidebar-text); }
        .sidebar-title { font-size: 1.2rem; font-weight: 600; }
        .sidebar-menu { list-style: none; margin: 0; padding: 0; }
        .sidebar-menu li a { display: flex; align-items: center; gap: 15px; padding: 15px 20px; color: var(--sidebar-text); text-decoration: none; transition: background-color var(--transition-speed); border-left: 4px solid transparent; }
        .sidebar-menu li a:hover { background-color: var(--sidebar-hover-bg); }
        .sidebar-menu li a.active { background-color: var(--sidebar-hover-bg); border-left-color: var(--primary-color); font-weight: bold; }
        .main-content { grid-area: content; padding: 30px; overflow-y: auto; }
        .footer { grid-area: footer; background-color: #ffffff; padding: 15px 30px; text-align: center; color: #888; border-top: 1px solid #e9ecef; }
        h1 { font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem; color: #2c3e50; }
        .content-card { background: white; border-radius: 8px; padding: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

        /* Filter v√† Search */
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-label {
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .date-range-group {
            display: flex;
            gap: 10px;
            align-items: center;
            background: white;
            padding: 0.8rem 1.2rem;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .date-input {
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
            min-width: 140px;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(32, 178, 170, 0.1);
        }

        .date-separator {
            color: #999;
            font-weight: bold;
        }

        .filter-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .filter-btn:hover {
            border-color: var(--primary-color);
        }
        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .search-input {
            padding: 0.7rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            flex: 1;
            min-width: 250px;
        }

        .search-btn {
            padding: 0.7rem 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .search-btn:hover {
            background: #17a2b8;
        }

        /* B·∫£ng danh s√°ch */
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        thead {
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #495057;
            font-size: 0.95rem;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
            color: #495057;
        }

        tbody tr {
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .stt {
            font-weight: 600;
            color: var(--primary-color);
        }

        .guest-info-cell {
            min-width: 200px;
        }

        .guest-name {
            font-weight: 600;
            color: #333;
        }

        .guest-phone {
            font-size: 0.85rem;
            color: #999;
        }

        .room-type-badge {
            display: inline-block;
            background: #c97c5c;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-confirmed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-occupied {
            background: #d4edda;
            color: #155724;
        }

        .price {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-primary {
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            background: #17a2b8;
        }

        .btn-success {
            padding: 0.5rem 1rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.show {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            padding: 0;
        }

        .close-modal:hover {
            color: #333;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .modal-info-item {
            display: flex;
            flex-direction: column;
        }

        .modal-info-label {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 0.3rem;
            font-weight: 600;
        }

        .modal-info-value {
            font-size: 1rem;
            color: #333;
            font-weight: 500;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            border-top: 1px solid #dee2e6;
            padding-top: 1rem;
        }

        .btn-cancel {
            padding: 0.7rem 1.5rem;
            background: #e9ecef;
            color: #495057;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-cancel:hover {
            background: #dee2e6;
        }

        /* Alert */
        .alert {
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .pagination a, .pagination form {
            padding: 0.7rem 1.2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination select {
            padding: 0.7rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination a:hover, .pagination select:hover {
            background: #17a2b8;
        }

        .pagination span {
            font-weight: bold;
            color: #333;
        }

        .pagination-disabled {
            padding: 0.7rem 1.2rem;
            color: #ccc;
            cursor: not-allowed;
            background: #f0f0f0;
            border-radius: 6px;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="dashboard-container" id="dashboard-container">
        <header class="header">
            <div class="menu-icon" id="header-menu-icon">‚ò∞</div>
            <div class="header-title">Qu·∫£n L√Ω Check-in</div>
            <div class="user-profile">
                <img src="https://i.pravatar.cc/150?u=receptionist" alt="User Avatar">
                <span>L·ªÖ t√¢n</span>
            </div>
        </header>

        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="menu-icon" id="sidebar-menu-icon">‚ò∞</div>
                <span class="sidebar-title">Menu</span>
            </div>
            <ul class="sidebar-menu">
                <li><a href="/receptionist/check-in" class="active">üìã Check-in</a></li>
                <li><a href="/receptionist/check-out">üö™ Check-out</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="content-card">
                <h1>üìã Danh S√°ch Nh·∫≠n Ph√≤ng</h1>

                <!-- Alert Messages -->
                <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
                <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>


                <!-- Tab Navigation -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 0;">
                    <a href="/receptionist/check-in?tab=pending"
                       th:classappend="${param.tab != 'checked' ? 'active' : ''}"
                       style="padding: 1rem 1.5rem; font-weight: 600; color: #666; text-decoration: none; border-bottom: 3px solid transparent; cursor: pointer; transition: all 0.3s;"
                       onmouseover="this.style.color='#20b2aa'"
                       onmouseout="this.style.color='#666'">
                        ‚è≥ Ch∆∞a Check-in
                    </a>
                    <a href="/receptionist/check-in?tab=checked"
                       th:classappend="${param.tab == 'checked' ? 'active' : ''}"
                       style="padding: 1rem 1.5rem; font-weight: 600; color: #666; text-decoration: none; border-bottom: 3px solid transparent; cursor: pointer; transition: all 0.3s;"
                       onmouseover="this.style.color='#28a745'"
                       onmouseout="this.style.color='#666'">
                        ‚úì ƒê√£ Check-in
                    </a>
                </div>

                <!-- Filter Section -->
                <form method="get" action="/receptionist/check-in">
                    <input type="hidden" name="tab" th:value="${param.tab ?: 'pending'}">
                    <input type="hidden" name="page" value="0">

                    <div class="filter-section">
                        <div class="filter-group" style="flex: 1; min-width: 250px;">
                            <input type="text" name="search" class="search-input"
                                   placeholder="üîç T√¨m ki·∫øm t√™n, email kh√°ch h√†ng..."
                                   th:value="${searchTerm}">
                            <button type="submit" class="search-btn">T√¨m</button>
                        </div>

                        <!-- Date Range Picker -->
                        <div class="date-range-group">
                            <span class="filter-label">T·ª´ ng√†y:</span>
                            <input type="date" name="fromDate" class="date-input" th:value="${fromDate}">

                            <span class="date-separator">‚Üí</span>

                            <span class="filter-label">ƒê·∫øn ng√†y:</span>
                            <input type="date" name="toDate" class="date-input" th:value="${toDate}">

                            <button type="submit" class="search-btn" style="padding: 0.6rem 1rem; margin-left: 5px;">L·ªçc</button>
                        </div>
                    </div>

                    <!-- Quick Filters -->
                    <div class="filter-section" style="margin-bottom: 15px;">
                        <button type="button" class="filter-btn" onclick="setDateRange('today', this.form)">H√¥m nay</button>
                        <button type="button" class="filter-btn" onclick="setDateRange('week', this.form)">1 Tu·∫ßn</button>
                        <button type="button" class="filter-btn" onclick="setDateRange('month', this.form)">1 Th√°ng</button>
                        <button type="button" class="filter-btn" onclick="clearDateRange(this.form)">X√≥a B·ªô L·ªçc</button>
                    </div>
                </form>

                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(reservations)}" class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <div class="empty-state-text">Kh√¥ng c√≥ ƒë·∫∑t ph√≤ng n√†o c·∫ßn check-in</div>
                </div>

                <!-- Table -->
                <div th:unless="${#lists.isEmpty(reservations)}" class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 4%;">STT</th>
                                <th style="width: 22%;">Th√¥ng tin kh√°ch h√†ng</th>
                                <th style="width: 12%;">H·∫°ng ph√≤ng</th>
                                <th style="width: 10%;">Gi·ªù nh·∫≠n</th>
                                <th style="width: 10%;">Gi·ªù tr·∫£</th>
                                <th style="width: 8%;">L∆∞u tr√∫</th>
                                <th style="width: 12%;">Gi√° ti·ªÅn/ng√†y</th>
                                <th style="width: 12%;">T·ªïng c·ªông</th>
                                <th style="width: 10%;">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="reservation, iterStat : ${reservations}">
                                <td class="stt" th:text="${(currentPage * pageSize) + iterStat.count}"></td>
                                <td class="guest-info-cell">
                                    <div class="guest-name" th:text="${reservation.guest.fullName}"></div>
                                    <div class="guest-phone" th:text="${'‚òéÔ∏è ' + reservation.guest.phoneNumber}"></div>
                                    <div class="guest-phone" th:text="${'üìß ' + reservation.guest.email}"></div>
                                </td>
                                <td>
                                    <span class="room-type-badge"
                                          th:text="${!reservation.reservation_rooms.isEmpty() ? reservation.reservation_rooms.get(0).room.roomType.typeName : 'N/A'}"></span>
                                </td>
                                <td th:text="${#dates.format(reservation.checkInDate, 'dd/MM/yyyy HH:mm')}"></td>
                                <td th:text="${#dates.format(reservation.checkOutDate, 'dd/MM/yyyy HH:mm')}"></td>
                                <!-- C·ªôt L∆∞u tr√∫ (s·ªë ng√†y) - Safe null check -->
                                <td class="price"
                                    th:if="${reservation.checkInDate != null && reservation.checkOutDate != null}"
                                    th:with="days=${(reservation.checkOutDate.time - reservation.checkInDate.time) / (1000 * 60 * 60 * 24)}"
                                    th:text="${#numbers.formatInteger(days, 0, 'COMMA')} + ' ng√†y'">
                                </td>
                                <td class="price" th:unless="${reservation.checkInDate != null && reservation.checkOutDate != null}">N/A</td>

                                <!-- Gi√° ti·ªÅn/ng√†y = BasePrice c·ªßa ph√≤ng -->
                                <td class="price"
                                    th:if="${!reservation.reservation_rooms.isEmpty()}"
                                    th:with="basePrice=${reservation.reservation_rooms.get(0).room.roomType.basePrice}"
                                    th:text="${#numbers.formatInteger(basePrice, 0, 'COMMA') + '‚Ç´'}">
                                </td>
                                <td class="price" th:unless="${!reservation.reservation_rooms.isEmpty()}">N/A</td>

                                <!-- T·ªïng c·ªông = totalAmount t·ª´ database (ph√≤ng + d·ªãch v·ª•) -->
                                <td class="price"
                                    th:text="${#numbers.formatInteger(reservation.totalAmount, 0, 'COMMA') + '‚Ç´'}">
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <!-- N·∫øu status = Pending (Ch∆∞a Check-in) -->
                                        <th:block th:if="${reservation.status == 'Pending'}">
                                            <button type="button" class="btn-primary"
                                                    th:onclick="'openCheckInModal(' + ${reservation.reservationId} + ')'">
                                                üîë Nh·∫≠n
                                            </button>
                                            <a th:href="@{/receptionist/add-service(reservationId=${reservation.reservationId})}"
                                               class="btn-primary">
                                                ‚ûï DV
                                            </a>
                                        </th:block>

                                        <!-- N·∫øu status = Confirmed (ƒê√£ Check-in) -->
                                        <th:block th:if="${reservation.status == 'Confirmed'}">
                                            <a href="/receptionist/occupied-rooms" class="btn-primary">
                                                ‚úèÔ∏è S·ª≠a ƒêP
                                            </a>
                                        </th:block>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination" th:if="${totalElements > 0}">
                    <!-- Previous Button -->
                    <a th:if="${currentPage > 0}"
                       th:href="@{/receptionist/check-in(page=${currentPage - 1}, size=${pageSize}, search=${searchTerm}, fromDate=${fromDate}, toDate=${toDate}, tab=${tab})}">
                        ‚Üê Tr∆∞·ªõc
                    </a>
                    <span th:if="${currentPage == 0}" class="pagination-disabled">‚Üê Tr∆∞·ªõc</span>

                    <!-- Page Info -->
                    <span>
                        Trang <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span> |
                        T·ªïng: <span th:text="${totalElements}"></span> b·∫£n ghi
                    </span>

                    <!-- Next Button -->
                    <a th:if="${totalPages > 1 && currentPage < totalPages - 1}"
                       th:href="@{/receptionist/check-in(page=${currentPage + 1}, size=${pageSize}, search=${searchTerm}, fromDate=${fromDate}, toDate=${toDate}, tab=${tab})}">
                        Sau ‚Üí
                    </a>
                    <span th:if="${totalPages <= 1 || currentPage >= totalPages - 1}" class="pagination-disabled">Sau ‚Üí</span>

                    <!-- Page Size Selector -->
                    <form method="get" action="/receptionist/check-in" style="display: inline; margin: 0;">
                        <input type="hidden" name="search" th:value="${searchTerm}">
                        <input type="hidden" name="fromDate" th:value="${fromDate}">
                        <input type="hidden" name="toDate" th:value="${toDate}">
                        <input type="hidden" name="tab" th:value="${tab}">
                        <input type="hidden" name="page" value="0">
                        <select name="size" onchange="this.form.submit();"
                                style="padding: 0.7rem 1rem; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            <option value="5" th:selected="${pageSize == 5}">5 b·∫£n ghi</option>
                            <option value="10" th:selected="${pageSize == 10}">10 b·∫£n ghi</option>
                            <option value="15" th:selected="${pageSize == 15}">15 b·∫£n ghi</option>
                            <option value="20" th:selected="${pageSize == 20}">20 b·∫£n ghi</option>
                        </select>
                    </form>
                </div>
            </div>
        </main>

        <footer class="footer">
            ¬© 2024 H·ªá th·ªëng Qu·∫£n L√Ω Kh√°ch S·∫°n. B·∫£n quy·ªÅn ƒë∆∞·ª£c b·∫£o v·ªá.
        </footer>
    </div>

    <!-- Modal Check-in -->
    <div class="modal" id="checkInModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîë X√°c Nh·∫≠n Nh·∫≠n Ph√≤ng</h2>
                <button type="button" class="close-modal" onclick="closeCheckInModal()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="modal-info-row">
                    <div class="modal-info-item">
                        <span class="modal-info-label">H·∫°ng ph√≤ng</span>
                        <span class="modal-info-value" id="modalRoomType">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">S·ªë ph√≤ng</span>
                        <span class="modal-info-value" id="modalRoomNumber">-</span>
                    </div>
                </div>

                <div class="modal-info-row">
                    <div class="modal-info-item">
                        <span class="modal-info-label">T√¨nh tr·∫°ng ph√≤ng</span>
                        <span class="modal-info-value" id="modalRoomStatus">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Kh√°ch h√†ng</span>
                        <span class="modal-info-value" id="modalGuestName">-</span>
                    </div>
                </div>

                <div class="modal-info-row">
                    <div class="modal-info-item">
                        <span class="modal-info-label">Gi·ªù nh·∫≠n ph√≤ng</span>
                        <span class="modal-info-value" id="modalCheckInTime">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Gi·ªù tr·∫£ ph√≤ng</span>
                        <span class="modal-info-value" id="modalCheckOutTime">-</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeCheckInModal()">‚ùå H·ªßy</button>
                <form id="checkInForm" method="post" action="/receptionist/check-in" style="display: flex; gap: 0.5rem; margin: 0;">
                    <input type="hidden" name="reservationId" id="modalReservationId">
                    <input type="hidden" name="page" th:value="${currentPage}">
                    <input type="hidden" name="size" th:value="${pageSize}">
                    <input type="datetime-local" name="checkInDateTime" id="checkInDateTimeInput" required style="padding: 0.7rem; border: 1px solid #ddd; border-radius: 4px; margin-right: 0.5rem;">
                    <button type="submit" class="btn-success">‚úì Nh·∫≠n Ph√≤ng</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sidebar toggle
        const headerMenuIcon = document.getElementById('header-menu-icon');
        const sidebarMenuIcon = document.getElementById('sidebar-menu-icon');
        const dashboardContainer = document.getElementById('dashboard-container');

        const toggleSidebar = () => {
            dashboardContainer.classList.toggle('sidebar-collapsed');
        };

        headerMenuIcon.addEventListener('click', toggleSidebar);
        sidebarMenuIcon.addEventListener('click', toggleSidebar);

        // Modal functions
        function openCheckInModal(reservationId) {
            // Hi·ªán t·∫°i ch·ªâ l·∫•y t·ª´ HTML, trong th·ª±c t·∫ø c·∫ßn g·ªçi API ƒë·ªÉ l·∫•y th√¥ng tin chi ti·∫øt
            const row = event.target.closest('tr');

            document.getElementById('modalReservationId').value = reservationId;
            document.getElementById('modalRoomType').textContent = row.querySelector('.room-type-badge').textContent;
            document.getElementById('modalRoomNumber').textContent = 'Ph√≤ng ' + (reservationId % 20 + 1);
            document.getElementById('modalRoomStatus').textContent = 'üî¥ Tr·ªëng';
            document.getElementById('modalGuestName').textContent = row.querySelector('.guest-name').textContent;
            document.getElementById('modalCheckInTime').textContent = row.cells[3].textContent;
            document.getElementById('modalCheckOutTime').textContent = row.cells[4].textContent;

            // Thi·∫øt l·∫≠p th·ªùi gian m·∫∑c ƒë·ªãnh l√† b√¢y gi·ªù
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('checkInDateTimeInput').value = localDateTime;

            document.getElementById('checkInModal').classList.add('show');
        }

        function closeCheckInModal() {
            document.getElementById('checkInModal').classList.remove('show');
        }

        // ƒê√≥ng modal khi click b√™n ngo√†i
        window.onclick = function(event) {
            const modal = document.getElementById('checkInModal');
            if (event.target == modal) {
                modal.classList.remove('show');
            }
        }

        // Auto-hide alerts sau 5 gi√¢y
        document.querySelectorAll('.alert').forEach(alert => {
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        });

        // ===== DATE RANGE FUNCTIONS =====
        function setDateRange(range, formElement) {
            const today = new Date();
            const fromDateInput = formElement.querySelector('input[name="fromDate"]');
            const toDateInput = formElement.querySelector('input[name="toDate"]');

            // Reset page v·ªÅ 0 khi filter
            let pageInput = formElement.querySelector('input[name="page"]');
            if (!pageInput) {
                pageInput = document.createElement('input');
                pageInput.type = 'hidden';
                pageInput.name = 'page';
                formElement.appendChild(pageInput);
            }
            pageInput.value = '0';

            let fromDate, toDate;

            switch(range) {
                case 'today':
                    fromDate = new Date(today);
                    toDate = new Date(today);
                    break;
                case 'week':
                    fromDate = new Date(today);
                    toDate = new Date(today);
                    toDate.setDate(today.getDate() + 7);
                    break;
                case 'month':
                    fromDate = new Date(today);
                    toDate = new Date(today);
                    toDate.setDate(today.getDate() + 30);
                    break;
            }

            fromDateInput.value = formatDate(fromDate);
            toDateInput.value = formatDate(toDate);
            formElement.submit();
        }

        function clearDateRange(formElement) {
            const fromDateInput = formElement.querySelector('input[name="fromDate"]');
            const toDateInput = formElement.querySelector('input[name="toDate"]');

            // Reset page v·ªÅ 0 khi clear filter
            let pageInput = formElement.querySelector('input[name="page"]');
            if (!pageInput) {
                pageInput = document.createElement('input');
                pageInput.type = 'hidden';
                pageInput.name = 'page';
                formElement.appendChild(pageInput);
            }
            pageInput.value = '0';

            fromDateInput.value = '';
            toDateInput.value = '';
            formElement.submit();
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Style active tab
        document.addEventListener('DOMContentLoaded', function() {
            const currentTab = new URLSearchParams(window.location.search).get('tab') || 'pending';
            const tabs = document.querySelectorAll('a[href*="?tab="]');
            tabs.forEach(tab => {
                if (tab.href.includes('tab=' + currentTab)) {
                    tab.style.color = currentTab === 'checked' ? '#28a745' : '#20b2aa';
                    tab.style.borderBottomColor = currentTab === 'checked' ? '#28a745' : '#20b2aa';
                    tab.style.borderBottomWidth = '3px';
                }
            });
        });
    </script>
</body>
</html>

